# Johnson Matthey Liferay Fragment Collection

## Overview
This project delivers a comprehensive Liferay fragment collection to recreate Johnson Matthey's corporate website. It provides modular, configurable, and responsive website components such as header with navigation, hero section, news carousel, share price widget, and footer. The goal is to ensure easy content editing, deployment, and adherence to Johnson Matthey's branding guidelines and Liferay's Classic theme.

## User Preferences
Preferred communication style: Simple, everyday language.
Preferred name: Call user "Kris".

## System Architecture
The project employs a modular, fragment-based architecture where each UI component is a self-contained Liferay fragment (HTML, CSS, JS, configuration). Global styles and scripts are managed via a client extension. All fragments are scoped under the `#wrapper` CSS selector and integrate seamlessly with Liferay's theme system using Liferay Classic theme tokens via CSS custom properties.

**Key Architectural Decisions:**
- **Dual-Deployment**: Client extension for global CSS/JS and fragment collection for UI components.
- **Fragment Modularity**: Each component is an independent Liferay fragment.
- **Color System**: Exclusive use of Liferay Classic theme frontend tokens for branding consistency.
- **JavaScript Isolation**: IIFEs and event-driven architecture ensure proper initialization and prevent global namespace pollution.
- **Content Management**: All content (text, images, links) is editable via Liferay's inline editing system using `data-lfr-editable` attributes.
- **Responsive Design**: Mobile-first approach using CSS Grid and Flexbox with consistent breakpoints.
- **Modal System**: Centralized system for login, search, and video modals, embedding Liferay portlets with extensive CSS overrides for consistent branding.
- **Animation System**: Scroll-triggered animations using CSS transitions/transforms and JavaScript Intersection Observers.
- **Fragment Configuration**: Uses `typeOptions.validValues` for select fields.
**FreeMarker Syntax**: Liferay fragments use `[#` brackets instead of `<#` - configuration conditionals use `[#if condition]content[/#if]` syntax.
- **Fragment Element Detection**: Fixed critical issue where `document.currentScript.closest()` fails in Liferay's ES module environment. All fragments now properly use the `fragmentElement` variable injected by Liferay instead of trying to find elements with `document.currentScript`.
- **Hero Fragment Image Fix**: Fixed "Each editable image element must contain an IMG tag" error by converting inline SVG to IMG element with SVG data URL, maintaining visual design while ensuring Liferay compatibility.
- **Header Logo Sizing**: Added fixed width="180" height="40" attributes to header logo for consistent sizing.
- **Footer Mobile Responsiveness Fix**: Complete mobile layout overhaul with single-column design for optimal readability. Mobile (768px and below) always uses single column regardless of desktop configuration, with all content perfectly centered and proper spacing.
- **CSS Specificity Fix**: Resolved Hero fragment visibility issue by removing `#wrapper` selector dependencies and CSS containment properties that were causing layout collapse. Fragments now use direct class selectors for maximum Liferay compatibility and guaranteed visibility on live sites.
- **Mobile Responsiveness Enhancement**: Fixed responsive layout issues with proper mobile breakpoints, improved text contrast for accessibility (WCAG AA compliance), and optimized mobile layout flow.
- **JM Card Fragment**:
    - **Standalone Component**: Complete card fragment for use in mega menus and page content
    - **Context-Aware Styling**: Automatically applies compact mode when used in mega menu dropzones
    - **Comprehensive Configuration**: Image, category, title, description, and button options with show/hide controls
    - **FreeMarker Integration**: Proper `configuration.variableName` syntax for all template variables
    - **Analytics Ready**: Built-in click tracking with contextual location data
    - **Accessibility Compliant**: WCAG AA standards with proper alt text and semantic HTML
    - **Performance Optimized**: Lazy loading, error handling, and minimal JavaScript footprint
- **Header Fragment**:
    - **Comprehensive Configuration**: Options for search, user menu visibility, sticky header, style variants (white/light/primary), navigation menu ID, and site prefix.
    - **Site Prefix Configuration**: Configurable URL prefix that replaces deprecated ThemeDisplay method for building navigation links.
    - **Editable Logo System**: Liferay-editable logo image.
    - **Dynamic Navigation**: Liferay Headless API integration with authentication and fallback system.
    - **Authentication Integration**: User management via Liferay personal bar and login modals.
    - **Search Functionality**: Embedded Liferay search portlets.
    - **Smart Edit Mode Detection**: Comprehensive edit mode detection and visual indicators with smart dropzone system.
    - **Language Selector Dropzone**: Positioned next to user profile for multilingual widget support.
    - **SPA Navigation Support**: Full SennaJS compatibility.
    - **Mobile Responsiveness**: Fixed hamburger menu and slide-out navigation with viewport-based resize handling.
    - **Sticky Header Implementation**: Reliable `position: fixed` implementation with full-width coverage and enhanced shadow.
    - **Mega Menu System**: 5 configurable dropzones that map to navigation items with children, featuring dynamic width sizing, content-aware display, mobile viewport visibility controls, and real-time content synchronization with mutation observers.
- **Hero Fragment**:
    - **Comprehensive Configuration**: Options for layout style (centered/split), background style (image/gradient/solid), show/hide stats, and show/hide video overlay.
    - **FreeMarker Integration**: All configuration options properly implemented using `[#if condition]` syntax for conditional rendering.
    - **Video Integration**: Modal video player with play button overlay, configurable visibility based on `showVideo` setting.
    - **Statistics Display**: Statistics section with configurable visibility based on `showStats` setting.
    - **Dynamic Styling**: Layout and background variants controlled through data attributes and CSS custom properties.
    - **Performance Ultra-Optimized**: Targeting 90+ Lighthouse score with aggressive LCP optimization (sub-2.5s), CLS elimination (<0.1), inline CSS for critical rendering, eager image loading, complete mobile responsiveness, and zero debugging artifacts. Self-contained Hero fragment with inline styles for immediate rendering.
    - **Render-Blocking Independence (Aug 16, 2025)**: Hero fragment completely immune to external CSS blocking (clay.css 900ms, global.css 794ms, main.css 300ms). LCP element `p.jm-hero-description` renders instantly with hardcoded CSS fallbacks, anti-blocking font rendering, and system font priority. Eliminates 79% render delay (2,480ms) identified in Lighthouse analysis.
    - **Ultra-Aggressive Hardcoding (Aug 16, 2025)**: All layout-related CSS variables replaced with fixed values - spacing (10rem, 4rem, 3rem, 1.5rem, etc.), typography (3.5rem, 1.25rem, 1.125rem, etc.), font weights (900, 600, 400), and border radius (0.5rem, 0.25rem). Only color and font-family variables retained for theme compatibility. Fragment now renders with zero dependency on external CSS variables.
    - **Direct Liferay Token Integration**: Optimized to use native Liferay theme tokens (var(--primary), var(--spacer-4), etc.) directly from the head style element, eliminating dependency on global.css client extension for instant loading performance.
- **Footer Fragment**:
    - **Comprehensive Configuration**: Options for newsletter signup, social media visibility, back-to-top button, company name, style variants (dark/light/primary), column layouts (5/4/3 columns), link tracking, and newsletter service integration.
    - **Dynamic Styling System**: Three footer style variants with complete color scheme adaptation.
    - **Flexible Column Layouts**: Responsive grid system.
    - **Configurable Components**: Show/hide controls for newsletter section, social media links, and back-to-top functionality.
    - **Company Branding**: Dynamic company name updates.
    - **Newsletter Integration**: Optional newsletter signup with multiple service provider options.
    - **Analytics Integration**: Configurable link tracking for footer navigation analytics.

## External Dependencies

**Liferay Platform:**
- **Liferay DXP/Portal**: Core platform for fragment rendering, theme system, and content management.
- **Liferay Classic Theme**: Provides frontend tokens and base styling.
- **Liferay Headless Delivery API**: Used for navigation menu structure and content data.
- **Liferay Fragment Editor**: Development and deployment environment.

**Liferay Portlets:**
- **Login Portlet** (`com_liferay_login_web_portlet_LoginPortlet`): Embedded in modal overlays.
- **Search Portlet**: Integrated into search modal functionality.
- **Navigation Portlet**: Provides dynamic navigation menu structure.

**Browser APIs:**
- **Intersection Observer API**: For scroll-triggered animations.
- **Fetch API**: For asynchronous data loading.
- **Local Storage API**: For user preferences and temporary data.

**Third-Party Services (Integrated):**
- **Stock Price APIs**: For share price widget.
- **YouTube/Vimeo APIs**: For video embedding.
- **Newsletter Services**: Custom Integration, Mailchimp, Campaign Monitor, Constant Contact.

**Asset Dependencies:**
- **SVG Icons**
- **Google Fonts**
- **Image Assets**: Managed through Liferay's document library.